<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Image Compressor - QuickTools Hub</title><meta name="description" content="Compress JPG/PNG/WebP images quickly in your browser. Files never leave your device."/><link rel="stylesheet" href="../css/style.css"/><link rel="icon" href="../assets/favicon.png"/></head><body><header class="header"><a class="brand" href="/"><span class="logo"></span><strong>QuickTools Hub</strong></a><a class="home-btn" href="/">Home</a></header><main class="container"><div class="tool-area"><h1>Image Compressor</h1><p class="small">Compress images (JPG/PNG/WebP) in your browser. Files never leave your device.</p><div class="upload" id="dropArea">Drag & drop or click to choose images<input type="file" id="ic_files" accept="image/*" multiple style="display:none"/></div><div style="margin-top:12px">Quality: <input id="ic_quality" type="range" min="0.1" max="1" step="0.05" value="0.8"/> <button id="ic_compress" class="home-btn" disabled>Compress</button></div><div id="ic_results" style="margin-top:12px"></div></div></main><footer class="footer"><div>Â© 2025 QuickTools Hub</div></footer><script src="../js/common.js"></script><script>
const dropArea = document.getElementById('dropArea'), icFiles = document.getElementById('ic_files'), icCompress = document.getElementById('ic_compress'), icResults = document.getElementById('ic_results');
let ic_list = [];
dropArea.addEventListener('click', ()=> icFiles.click());
dropArea.addEventListener('dragover', e=>{ e.preventDefault(); dropArea.style.background='rgba(61,164,171,0.04)'; });
dropArea.addEventListener('dragleave', ()=> dropArea.style.background='');
dropArea.addEventListener('drop', e=>{ e.preventDefault(); dropArea.style.background=''; handleFiles(Array.from(e.dataTransfer.files)); });
icFiles.addEventListener('change', ()=> handleFiles(Array.from(icFiles.files)));
function handleFiles(files){
  files.forEach(f=>{
    if(!f.type.startsWith('image/')) return;
    const idx = ic_list.push(f)-1;
    const item = document.createElement('div'); item.className='meta'; item.style.display='flex'; item.style.flexDirection='column'; item.style.gap='8px';
    const before = document.createElement('div'); before.className='before'; before.innerHTML = '<strong>Before</strong><div class="kv">Loading preview...</div>';
    const after = document.createElement('div'); after.className='after'; after.innerHTML = '<strong>After</strong><div class="kv">Not processed yet</div>';
    item.appendChild(before); item.appendChild(after);
    icResults.appendChild(item);
    // load preview
    const reader = new FileReader();
    reader.onload = function(e){
      const img = new Image();
      img.onload = function(){
        const imgEl = document.createElement('img'); imgEl.src = e.target.result; imgEl.className='preview'; imgEl.style.maxWidth='280px'; before.innerHTML = '<strong>Before</strong>'; before.appendChild(imgEl); before.appendChild(Object.assign(document.createElement('div'),{className:'kv',textContent: (f.size/1024).toFixed(1)+' KB'}));
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(f);
  });
  if(ic_list.length) icCompress.disabled=false;
}

icCompress.addEventListener('click', async ()=>{
  if(!ic_list.length) return;
  icCompress.disabled=true; icCompress.textContent='Working...';
  const quality = parseFloat(document.getElementById('ic_quality').value);
  const items = Array.from(icResults.children);
  for(let i=0;i<ic_list.length;i++){
    const f = ic_list[i];
    const item = items[i];
    try{
      const dataURL = await compressFile(f, quality);
      const blob = dataURLToBlob(dataURL);
      const url = URL.createObjectURL(blob);
      const afterDiv = item.querySelector('.after');
      afterDiv.innerHTML = '<strong>After</strong>';
      const img = document.createElement('img'); img.src = url; img.className='preview'; img.style.maxWidth='280px';
      afterDiv.appendChild(img);
      afterDiv.appendChild(Object.assign(document.createElement('div'),{className:'kv',textContent: (blob.size/1024).toFixed(1)+' KB'}));
      const a = document.createElement('a'); a.href = url; a.download = 'compressed-'+f.name; a.className='home-btn'; a.textContent='Download'; a.style.display='inline-block'; a.style.marginTop='8px';
      afterDiv.appendChild(a);
      URL.revokeObjectURL(url);
    }catch(err){
      const afterDiv = item.querySelector('.after');
      afterDiv.innerHTML = '<strong>Error processing file</strong>';
    }
  }
  icCompress.textContent='Compress'; icCompress.disabled=false; ic_list=[];
});

function compressFile(file, quality){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload=function(e){
      const img=new Image();
      img.onload=function(){
        const MAX=1600;
        const ratio=Math.min(1, MAX/img.width);
        const canvas=document.createElement('canvas');
        canvas.width=Math.round(img.width*ratio);
        canvas.height=Math.round(img.height*ratio);
        const ctx=canvas.getContext('2d');
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        canvas.toBlob(function(blob){
          if(!blob) return reject(new Error('Compression failed'));
          const r = new FileReader();
          r.onload = function(e2){ resolve(e2.target.result); };
          r.onerror = reject;
          r.readAsDataURL(blob);
        }, 'image/jpeg', quality);
      };
      img.onerror = reject;
      img.src = e.target.result;
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function dataURLToBlob(dataurl){
  const arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  while(n--) u8arr[n] = bstr.charCodeAt(n);
  return new Blob([u8arr], {type:mime});
}
</script></body></html>